"use strict";(self["webpackChunkcolors"]=self["webpackChunkcolors"]||[]).push([[569],{73299:function(e,t,s){s.r(t),s.d(t,{default:function(){return T}});var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"aloneMeeting"},[t("div",{staticClass:"contents"},[t("div",{staticClass:"camera"},[t("webcam",{ref:"camStream",attrs:{id:"webcam"}}),t("div",{staticClass:"buttons"},[t("customButton",{staticClass:"mute",class:{muteActive:e.publishAudio},attrs:{btnText:"음소거"},on:{click:e.muteAudio}}),t("customButton",{staticClass:"videostop",class:{muteActive:e.publishVideo},attrs:{btnText:"비디오 중지"},on:{click:e.muteVideo}})],1)],1),t("div",{staticClass:"rightSidebar"},[e._m(0),t("colorpallete",{staticClass:"pallete"}),t("div",{staticClass:"selectColor"},[t("colorchoice",{on:{changeColor:e.changeColor}})],1),t("customButton",{ref:"colorchoice",staticClass:"selectColorbtn",attrs:{btnText:"색상 팔레트에 담기"},on:{click:e.showOneSelectedColor}}),t("customButton",{staticClass:"votebtn",attrs:{btnText:"투표하기"},on:{click:e.goVote}}),t("customButton",{staticClass:"exitbtn",attrs:{btnText:"종료"},on:{click:e.exit}}),t("custom-modal",{directives:[{name:"show",rawName:"v-show",value:e.showModal,expression:"showModal"}],staticClass:"updateUserProfileModal",attrs:{id:"updateUserProfileModal",titleText:"투표 방식 선택"},on:{"close-modal":function(t){e.showModal=!1}}},[t("cotent",[t("div",{staticClass:"vote"},[t("div",[t("customButton",{staticClass:"selectVotebtn",attrs:{btnText:"토너먼트 형식으로 투표하기"},on:{click:e.goton}})],1),t("div",[t("customButton",{staticClass:"selectVotebtn",attrs:{btnText:"베스트 원픽 투표하기"},on:{click:e.gobest}})],1),t("div",{staticClass:"coment"},[e._v("토너먼트 형식 : 8강전부터 베스트 컬러 선택 "),t("br"),e._v("베스트 원픽 : 8개의 컬러 중 베스트 컬러 선택")])])])],1)],1)])])},i=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"title"},[t("h2",[e._v("나만의 색상 팔레트")]),t("hr")])}],a=(s(82801),s(48675),s(3462),s(37380),s(1118),s(66970)),r=function(){var e=this,t=e._self._c;return e.session?t("div",{attrs:{id:"session"}},[t("div",{staticClass:"col-md-6",attrs:{id:"main-video"}},[t("user-video",{attrs:{"stream-manager":e.mainStreamManager}})],1)]):e._e()},n=[],l=s(56265),h=s.n(l),c=s(9801),d=s(18496);h().defaults.headers.post["Content-Type"]="application/json";const u="https://"+location.hostname+":40001",m="i7b208";var g={name:"App",components:{UserVideo:d.Z},data(){return{OV:void 0,session:!0,mainStreamManager:void 0,publisher:void 0,subscribers:[],mySessionId:sessionStorage.getItem("sessionCode"),myUserName:"Participant"+Math.floor(100*Math.random())}},computed:{publishAudio(){return this.$store.getters.getPublishAudio},publishVideo(){return this.$store.getters.getPublishVideo}},beforeMount(){this.publishAudio&&this.$store.commit("changePublishAudio"),this.publishVideo&&this.$store.commit("changePublishVideo"),this.joinSession()},methods:{muteAudio(){this.publisher.publishAudio(this.publishAudio),console.log(this.publishAudio),this.$store.commit("changePublishAudio")},muteVideo(){this.publisher.publishVideo(this.publishVideo),this.$store.commit("changePublishVideo")},joinSession(){this.OV=new c.Dn,this.session=this.OV.initSession(),this.session.on("streamCreated",(({stream:e})=>{const t=this.session.subscribe(e);this.subscribers.push(t)})),this.session.on("streamDestroyed",(({stream:e})=>{const t=this.subscribers.indexOf(e.streamManager,0);t>=0&&this.subscribers.splice(t,1)})),this.session.on("exception",(({exception:e})=>{console.warn(e)})),this.getToken(this.mySessionId).then((e=>{this.session.connect(e,{clientData:this.myUserName}).then((()=>{let e=this.OV.initPublisher(void 0,{audioSource:void 0,videoSource:void 0,publishAudio:!0,publishVideo:!0,resolution:"800x420",frameRate:30,insertMode:"APPEND",mirror:!1});this.mainStreamManager=e,this.publisher=e,this.session.publish(this.publisher)})).catch((e=>{console.log("There was an error connecting to the session:",e.code,e.message)}))})),window.addEventListener("beforeunload",this.leaveSession)},leaveSession(){this.session&&(this.session.disconnect(),console.log("session disconnected")),this.session=void 0,this.mainStreamManager=void 0,this.publisher=void 0,this.subscribers=[],this.OV=void 0,window.removeEventListener("beforeunload",this.leaveSession)},updateMainVideoStreamManager(e){this.mainStreamManager!==e&&(this.mainStreamManager=e)},getToken(e){return this.createSession(e).then((e=>this.createToken(e)))},createSession(e){return new Promise(((t,s)=>{h().post(`${u}/openvidu/api/sessions`,JSON.stringify({customSessionId:e}),{auth:{username:"OPENVIDUAPP",password:m}}).then((e=>e.data)).then((e=>t(e.id))).catch((o=>{409===o.response.status?t(e):(console.warn(`No connection to OpenVidu Server. This may be a certificate error at ${u}`),window.confirm(`No connection to OpenVidu Server. This may be a certificate error at ${u}\n\nClick OK to navigate and accept it. If no certificate warning is shown, then check that your OpenVidu Server is up and running at "${u}"`)&&location.assign(`${u}/accept-certificate`),s(o.response))}))}))},createToken(e){return new Promise(((t,s)=>{h().post(`${u}/openvidu/api/sessions/${e}/connection`,{},{auth:{username:"OPENVIDUAPP",password:m}}).then((e=>e.data)).then((e=>t(e.token))).catch((e=>s(e.response)))}))}}},b=g,p=s(1001),v=(0,p.Z)(b,r,n,!1,null,"adfefee4",null),C=v.exports,f=s(23334),w=s(14636),S=s(92269),$=s.n(S),V=s(24840),x=s.n(V),A=s(41952),y=s(93495),I=s.n(y),P={name:"aloneMeeting",components:{webcam:C,colorpallete:f.Z,colorchoice:w.Z},mixins:[a.Z],data(){return{modelRgba:"",modelHex:"",r:0,g:0,b:0,a:1,h:0,s:0,v:0,count_pallete:0,selectedColorLst:["#000000","#000000","#000000","#000000","#000000","#000000"],awsid:"ap-northeast-2:ec08827e-a81a-4cad-813c-fe0d18e8d3d6",showModal:!1}},mounted(){this.r=0,this.g=0,this.b=0,this.a=1,this.$store.state.resultStore.voteRound=1;let e=JSON.parse(sessionStorage.getItem("memberData")),t=e.data.id,s=sessionStorage.getItem("roomId");console.log(s),h().put(this.$store.state.baseurl+"room/status",{roomid:s,hostid:t}).then((e=>{console.log(e)}))},computed:{rgba(){return{r:this.r,g:this.g,b:this.b,a:this.a}},hsv(){return{h:this.h,s:this.s,v:this.v}},publishAudio(){return this.$store.getters.getPublishAudio},publishVideo(){return this.$store.getters.getPublishVideo}},created(){Object.assign(this,this.setColorValue(this.color)),this.setText(),this.$watch("rgba",(()=>{this.$emit("changeColor",{rgba:this.rgba,hsv:this.hsv,hex:this.modelHex})}))},beforeRouteLeave(e,t,s){this.$refs.camStream.leaveSession(),setTimeout((()=>{s(),this.$router.go()}),100)},methods:{goton(){A.Z.push("/aloneTournament")},gobest(){A.Z.push("/aloneVoting")},muteAudio(){console.log(this.publishAudio),this.$refs.camStream.muteAudio()},muteVideo(){this.$refs.camStream.muteVideo()},showOneSelectedColor(){if(this.count_pallete<8){this.modelHex=this.rgb2hex(this.rgba,!0);var e=0;console.log(this.$store.state.selectedColorLst);for(var t=0;t<this.count_pallete;t++)this.$store.state.selectedColorLst[t]==this.modelHex&&(I()("색상 담기","중복된 색이 있습니다.","error"),e=1);if(1==e)return;console.log(this.modelHex),this.$store.commit("NEW_COLOR",{color:this.modelHex}),this.selectedColorLst=this.$store.state.selectedColorLst,this.selectedColorLst.splice(this.count_pallete,1,this.$store.state.storeselectedColor.color),this.$store.state.selectedColorLst=this.selectedColorLst;var s=this.modelHex.substr(1);console.log(s);var o=this.awsid,i=sessionStorage.getItem("userId"),a=this.count_pallete;$()(document.getElementById("webcam")).then((function(e){var t=e.toDataURL("image/jpeg"),r=t.split(","),n=r[0].match(/:(.*?);/)[1],l=atob(r[1]),h=l.length,c=new Uint8Array(h);while(h--)c[h]=l.charCodeAt(h);var d=new File([c],s,{type:n});console.log(d),x().config.update({region:"ap-northeast-2",credentials:new(x().CognitoIdentityCredentials)({IdentityPoolId:o})});var u=new(x().S3)({apiVersion:"2012-10-17",params:{Bucket:"ssafy7color"}}),m=new Date,g=m.getFullYear()+""+(m.getMonth()+1)+m.getDate(),b=sessionStorage.getItem("roomCode");let p=g+"/"+i+"/"+b+"/"+s+a+".jpg";u.upload({Key:p,Body:d,ACL:"public-read"},((e,t)=>{e&&console.log(e),console.log("Successfully uploaded photo."),console.log(t)}))})),this.count_pallete++}else I()("색상 담기","컬러 팔레트가 꽉찼습니다.","error")},goVote(){var e=this.awsid,t=sessionStorage.getItem("userId");x().config.update({region:"ap-northeast-2",credentials:new(x().CognitoIdentityCredentials)({IdentityPoolId:e})});var s=new(x().S3)({apiVersion:"2012-10-17",params:{Bucket:"ssafy7color"}}),o=new Date,i=o.getFullYear()+""+(o.getMonth()+1)+o.getDate(),a=sessionStorage.getItem("roomCode");let r=i+"/"+t+"/"+a+"/";console.log(r),s.listObjects({Delimiter:"/",Prefix:r},((e,t)=>{if(e)return I()("투표하기","There was an error : "+e.message,"error");{var s=[],o={url:"",code:""};this.lists=t.Contents,this.lists.forEach((e=>{var t="https://ssafy7color.s3.ap-northeast-2.amazonaws.com/"+e.Key,i="#"+t.slice(t.length-11,t.length-5);o={url:t,code:i},s.push(o)})),console.log(s);let e=sessionStorage.getItem("roomId"),i=JSON.parse(sessionStorage.getItem("memberData")),a=i.data.id;const r={roomid:e,userid:a,colorset:s};console.log(r),h().post(this.$store.state.baseurl+"room/result",r).then((e=>{console.log(e)}))}})),this.showModal=!0},dataURLtoFile(e,t){var s=e.split(","),o=s[0].match(/:(.*?);/)[1],i=atob(s[1]),a=i.length,r=new Uint8Array(a);while(a--)r[a]=i.charCodeAt(a);return new File([r],t,{type:o})},setText(){this.modelHex=this.rgb2hex(this.rgba,!0),this.modelRgba=`${this.r}, ${this.g}, ${this.b}, ${this.a}`},changeColor(e){const{r:t,g:s,b:o,a:i,h:a,s:r,v:n}=this.setColorValue(e.rgba);Object.assign(this,{r:t,g:s,b:o,a:i,h:a,s:r,v:n}),this.modelHex=e.hex,this.$store.state.r=this.r,this.$store.state.g=this.g,this.$store.state.b=this.b},exit(){this.$router.push("/enterPage")}}},M=P,O=(0,p.Z)(M,o,i,!1,null,"48d14c03",null),T=O.exports}}]);
//# sourceMappingURL=569.7207c47c.js.map